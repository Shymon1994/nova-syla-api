# –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Binotel Call Password

## –û–≥–ª—è–¥

–°–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Binotel Call Password API –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —á–µ—Ä–µ–∑ –¥–∑–≤—ñ–Ω–∫–∏ –∞–±–æ SMS.

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. Credentials (.env —Ñ–∞–π–ª)

```env
BINOTEL_KEY=035963-ac29f32
BINOTEL_SECRET=b3aa55-bf46d3-b0e6a6-99dc8a-8f8a984c
BINOTEL_COMPANY_ID=57612
```

### 2. API Endpoints

#### –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∑–≤—ñ–Ω–∫–∞ –∑ –∫–æ–¥–æ–º
**Endpoint:** `POST /api/v2/auth/request-code`

**Request:**
```json
{
  "phone": "+380960608968"
}
```

**Response (—É—Å–ø—ñ—Ö):**
```json
{
  "success": true,
  "data": {
    "phone": "+380960608968",
    "expiresIn": 600,
    "message": "–û—á—ñ–∫—É–π—Ç–µ –¥–∑–≤—ñ–Ω–æ–∫. –í–≤–µ–¥—ñ—Ç—å –æ—Å—Ç–∞–Ω–Ω—ñ 4 —Ü–∏—Ñ—Ä–∏ –Ω–æ–º–µ—Ä–∞."
  },
  "message": "–î–∑–≤—ñ–Ω–æ–∫ –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è"
}
```

#### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–¥—É
**Endpoint:** `POST /api/v2/auth/verify-code`

**Request:**
```json
{
  "phone": "+380960608968",
  "code": "1234"
}
```

**Response (—É—Å–ø—ñ—Ö):**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "phone": "+380960608968",
      "clientId": "12345",
      "name": "–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ",
      "balance": 150,
      "level": "–ó–æ–ª–æ—Ç–æ"
    }
  },
  "message": "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞"
}
```

**Response (–ø–æ–º–∏–ª–∫–∞):**
```json
{
  "success": false,
  "error": {
    "code": "INVALID_CODE",
    "message": "–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑."
  }
}
```

## –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏

### –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∫–æ–¥—É (request-code)

1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –ë–î
2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ rate limiting (–Ω–µ —á–∞—Å—Ç—ñ—à–µ –Ω—ñ–∂ —Ä–∞–∑ –≤ 10 —Ö–≤–∏–ª–∏–Ω)
3. –í–∏–∫–ª–∏–∫ Binotel API: `verification-by-call-with-cid.json`
4. Binotel –≥–µ–Ω–µ—Ä—É—î 4-–∑–Ω–∞—á–Ω–∏–π –∫–æ–¥ —ñ –∑–¥—ñ–π—Å–Ω—é—î –¥–∑–≤—ñ–Ω–æ–∫
5. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î –¥–∑–≤—ñ–Ω–æ–∫ –∑ –Ω–æ–º–µ—Ä–∞, –¥–µ –æ—Å—Ç–∞–Ω–Ω—ñ 4 —Ü–∏—Ñ—Ä–∏ = –∫–æ–¥

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–¥—É (verify-code)

1. –í–∏–∫–ª–∏–∫ Binotel API: `checking-verification-code.json`
2. Binotel –ø–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –∫–æ–¥ –≤–∞–ª—ñ–¥–Ω–∏–π
3. –Ø–∫—â–æ –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π - –≤–∏–¥–∞—î–º–æ JWT —Ç–æ–∫–µ–Ω
4. –Ø–∫—â–æ –∫–æ–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π - –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ–º–∏–ª–∫—É

## –û–±–º–µ–∂–µ–Ω–Ω—è —ñ –ø—Ä–∞–≤–∏–ª–∞

### –ü–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∫–æ–¥—É:
- –ú—ñ–∂ 1-–æ—é —Ç–∞ 2-–æ—é —Å–ø—Ä–æ–±–æ—é: **60 —Å–µ–∫—É–Ω–¥**
- –ú—ñ–∂ 2-–æ—é —Ç–∞ 3-–æ—é —Å–ø—Ä–æ–±–æ—é: **120 —Å–µ–∫—É–Ω–¥**
- –ü—ñ—Å–ª—è 3-—ó —Å–ø—Ä–æ–±–∏: **300 —Å–µ–∫—É–Ω–¥**

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±:
- **3 —Å–ø—Ä–æ–±–∏** –Ω–∞ –æ–¥–∏–Ω —Å–µ–∞–Ω—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
- –ü—ñ—Å–ª—è 3-—ó –Ω–µ–≤–¥–∞–ª–æ—ó —Å–ø—Ä–æ–±–∏ - –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –Ω–∞ **24 –≥–æ–¥–∏–Ω–∏**
- –í—Å—ñ 3 —Å–ø—Ä–æ–±–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å **—Ç–æ–π —Å–∞–º–∏–π –∫–æ–¥**

### –ß–∞—Å –¥—ñ—ó –∫–æ–¥—É:
- –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: **10 —Ö–≤–∏–ª–∏–Ω**
- –ü—ñ—Å–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–≤–µ–¥–µ–Ω–Ω—è –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –Ω–æ–≤–∏–π –∫–æ–¥

## Binotel API (—Ç–µ—Ö–Ω—ñ—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è)

### Base URL
```
https://api.binotel.com/api/4.0
```

### –ú–µ—Ç–æ–¥–∏

#### 1. –î–∑–≤—ñ–Ω–æ–∫ –∑ –∫–æ–¥–æ–º
```
POST /callpassword/verification-by-call-with-cid.json
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `key` - API –∫–ª—é—á
- `secret` - API —Å–µ–∫—Ä–µ—Ç
- `phoneNumberInE164` - –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É (380XXXXXXXXX)
- `application` - –Ω–∞–∑–≤–∞ –¥–æ–¥–∞—Ç–∫—É ("NovaLoyalty")
- `lifetime` - —á–∞—Å –∂–∏—Ç—Ç—è –∫–æ–¥—É –≤ —Ö–≤–∏–ª–∏–Ω–∞—Ö (10)
- `codeLength` - –¥–æ–≤–∂–∏–Ω–∞ –∫–æ–¥—É (4)

#### 2. SMS –∑ –∫–æ–¥–æ–º
```
POST /callpassword/verification-by-sms.json
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `key` - API –∫–ª—é—á
- `secret` - API —Å–µ–∫—Ä–µ—Ç
- `phoneNumberInE164` - –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É (380XXXXXXXXX)
- `senderId` - —ñ–º'—è –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–∞ ("NovaSyla")
- `application` - –Ω–∞–∑–≤–∞ –¥–æ–¥–∞—Ç–∫—É ("NovaLoyalty")
- `lifetime` - —á–∞—Å –∂–∏—Ç—Ç—è –∫–æ–¥—É –≤ —Ö–≤–∏–ª–∏–Ω–∞—Ö (10)
- `codeLength` - –¥–æ–≤–∂–∏–Ω–∞ –∫–æ–¥—É (4)

#### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–¥—É
```
POST /callpassword/checking-verification-code.json
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `key` - API –∫–ª—é—á
- `secret` - API —Å–µ–∫—Ä–µ—Ç
- `phoneNumberInE164` - –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É (380XXXXXXXXX)
- `application` - –Ω–∞–∑–≤–∞ –¥–æ–¥–∞—Ç–∫—É ("NovaLoyalty")
- `code` - –∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (4 —Ü–∏—Ñ—Ä–∏)

**–í—ñ–¥–ø–æ–≤—ñ–¥—ñ:**
```json
// –£—Å–ø—ñ—Ö
{ "status": "success", "message": "Successfully verified code" }

// –ü–æ–º–∏–ª–∫–∞
{ "status": "failed", "message": "Bad verification code" }
```

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–¥—ñ

### BinotelService

```typescript
import binotelService from '../services/binotel.service';

// –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∑–≤—ñ–Ω–∫–∞
const result = await binotelService.sendCallVerification(
  '380960608968',     // phone (–±–µ–∑ +)
  'NovaLoyalty',      // application
  10,                 // lifetime (—Ö–≤–∏–ª–∏–Ω–∏)
  4                   // codeLength
);

// –í—ñ–¥–ø—Ä–∞–≤–∫–∞ SMS
const result = await binotelService.sendSmsVerification(
  '380960608968',     // phone (–±–µ–∑ +)
  'NovaLoyalty',      // application
  'NovaSyla',         // senderId
  10,                 // lifetime (—Ö–≤–∏–ª–∏–Ω–∏)
  4                   // codeLength
);

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–¥—É
const verification = await binotelService.checkVerificationCode(
  '380960608968',     // phone (–±–µ–∑ +)
  '1234',             // code
  'NovaLoyalty'       // application
);

if (verification.success) {
  // –ö–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
} else {
  // –ö–æ–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
}
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –¢–µ—Å—Ç –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–∑–≤—ñ–Ω–∫–∞
```bash
curl -X POST http://localhost:3001/api/v2/auth/request-code \
  -H "Content-Type: application/json" \
  -d '{"phone":"+380960608968"}'
```

### 2. –¢–µ—Å—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–¥—É
```bash
curl -X POST http://localhost:3001/api/v2/auth/verify-code \
  -H "Content-Type: application/json" \
  -d '{"phone":"+380960608968","code":"1234"}'
```

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

–í—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è:
- ‚úÖ –£—Å–ø—ñ—à–Ω—ñ –¥–∑–≤—ñ–Ω–∫–∏
- ‚ùå –ü–æ–º–∏–ª–∫–∏ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
- üîç –°–ø—Ä–æ–±–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–¥—É
- üìä Rate limiting

–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏:
```bash
cd backend
cat logs/app.log
```

## –ë–µ–∑–ø–µ–∫–∞

‚ö†Ô∏è **–í–∞–∂–ª–∏–≤–æ:**
- Credentials –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –≤ `.env` —Ñ–∞–π–ª—ñ
- `.env` —Ñ–∞–π–ª –ù–ï –∫–æ–º—ñ—Ç–∏—Ç—å—Å—è –≤ Git (—î –≤ `.gitignore`)
- API –∫–ª—é—á—ñ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É
- Rate limiting –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ —Å–ø–∞–º—É
- JWT —Ç–æ–∫–µ–Ω –≤–∏–¥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

## –ö–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–µ—Ö–Ω—ñ—á–Ω–æ—ó –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ Binotel

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø—Ä–æ–±–ª–µ–º–∏ –∑ API, –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ —Ç–µ—Ö–Ω—ñ—á–Ω–æ—é –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é Binotel:
- Email: support@binotel.com
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è: https://api.binotel.com/
